<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Senti</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #faf9f6;
    margin: 0;
    padding: 20px;
    color: #111;
  }
  h1 {
    font-size: 40px;
    margin: 0 0 10px;
  }
  button {
    border-radius: 14px;
    border: none;
    padding: 14px;
    font-size: 16px;
    cursor: pointer;
  }
  .pill {
    background: #eee;
    padding: 8px 14px;
    border-radius: 12px;
  }
  .card {
    background: white;
    border-radius: 20px;
    padding: 18px;
    margin-bottom: 16px;
  }
  .row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .muted {
    color: #777;
  }
  .green {
    color: #1e7f57;
    font-weight: 600;
  }
  .red {
    color: #c24a3a;
    font-weight: 600;
  }
  .primary {
    background: #1e7f57;
    color: white;
    width: 100%;
    font-size: 18px;
    margin-top: 16px;
  }
  .hidden {
    display: none;
  }
  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  li {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
  }
  input {
    width: 100%;
    padding: 14px;
    margin-bottom: 10px;
    border-radius: 12px;
    border: 1px solid #ddd;
    font-size: 16px;
  }
  .tabs {
    display: flex;
    margin-bottom: 12px;
  }
  .tab {
    flex: 1;
    padding: 12px;
    text-align: center;
    border-radius: 12px;
    border: 1px solid #ccc;
  }
  .tab.active {
    background: #1e7f57;
    color: white;
    border-color: #1e7f57;
  }
</style>
</head>

<body>

<!-- HOME -->
<section id="home" class="screen">
  <div class="row">
    <h1>Senti</h1>
    <button id="goYear" class="pill">Year</button>
  </div>

  <div class="card">
    <div class="muted">This Month</div>
    <h1 id="homeBalance">0</h1>
    <div class="row">
      <div id="homeIn" class="green">0</div>
      <div id="homeOut" class="red">0</div>
    </div>
  </div>

  <div class="card">
    <h3>Where your money went</h3>
    <ul id="homeCats"></ul>
    <button id="toggleCats" class="pill hidden">View all categories</button>
  </div>

  <button id="goAdd" class="primary">+ Add Entry</button>
</section>

<!-- YEAR -->
<section id="year" class="screen hidden">
  <div class="card">
    <h2>This Year</h2>
    <ul id="yearList"></ul>
    <button id="backHome" class="pill">Back</button>
  </div>
</section>

<!-- ADD -->
<section id="add" class="screen hidden">
  <h2>Add Entry</h2>

  <div class="tabs">
    <div id="typeOut" class="tab active">Out</div>
    <div id="typeIn" class="tab">In</div>
  </div>

  <input id="amount" type="number" placeholder="Amount" />
  <input id="category" placeholder="Category" />
  <input id="note" placeholder="Note (optional)" />

  <button id="save" class="primary">Save</button>
  <button id="cancel" class="pill">Cancel</button>
</section>

<script>
/* ========= DATA ========= */
let entries = JSON.parse(localStorage.getItem("senti") || "[]");
let entryType = "out";
let catsExpanded = false;

/* ========= HELPERS ========= */
function fmt(n) {
  return Number(n || 0).toLocaleString("en-US");
}

function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function monthKey(d) {
  return d.getFullYear() + "-" + d.getMonth();
}

function monthLabel(key) {
  const [y, m] = key.split("-");
  return new Date(y, m).toLocaleString("default", { month: "long", year: "numeric" });
}

/* ========= HOME ========= */
function renderHome() {
  const now = new Date();
  let inc = 0, out = 0, cats = {};

  entries.forEach(e => {
    const d = new Date(e.date);
    if (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) {
      if (e.type === "in") inc += e.amount;
      else {
        out += e.amount;
        cats[e.category] = (cats[e.category] || 0) + e.amount;
      }
    }
  });

  homeBalance.textContent = fmt(inc - out);
  homeIn.textContent = fmt(inc);
  homeOut.textContent = fmt(out);

  homeCats.innerHTML = "";
  const all = Object.entries(cats);
  const visible = catsExpanded ? all : all.slice(0, 4);

  visible.forEach(([c, v]) => {
    homeCats.innerHTML += `<li><span>${c}</span><strong>${fmt(v)}</strong></li>`;
  });

  toggleCats.classList.toggle("hidden", all.length <= 4);
  toggleCats.textContent = catsExpanded ? "Show less" : "View all categories";
}

/* ========= YEAR ========= */
function renderYear() {
  const map = {};
  entries.forEach(e => {
    const k = monthKey(new Date(e.date));
    map[k] = map[k] || { in: 0, out: 0 };
    map[k][e.type] += e.amount;
  });

  yearList.innerHTML = "";
  Object.keys(map).sort().reverse().forEach(k => {
    const bal = map[k].in - map[k].out;
    yearList.innerHTML += `
      <li onclick="openMonth('${k}')">
        <span>${monthLabel(k)}</span>
        <strong>${fmt(bal)}</strong>
      </li>`;
  });
}

/* ========= EVENTS ========= */
goAdd.onclick = () => show("add");
cancel.onclick = () => show("home");
goYear.onclick = () => { renderYear(); show("year"); };
backHome.onclick = () => show("home");

toggleCats.onclick = () => {
  catsExpanded = !catsExpanded;
  renderHome();
};

typeOut.onclick = () => {
  entryType = "out";
  typeOut.classList.add("active");
  typeIn.classList.remove("active");
};

typeIn.onclick = () => {
  entryType = "in";
  typeIn.classList.add("active");
  typeOut.classList.remove("active");
};

save.onclick = () => {
  const amt = Number(amount.value);
  if (!amt || amt <= 0) return;

  entries.push({
    type: entryType,
    amount: amt,
    category: category.value || "Other",
    note: note.value || "",
    date: new Date().toISOString()
  });

  localStorage.setItem("senti", JSON.stringify(entries));
  amount.value = category.value = note.value = "";
  show("home");
  renderHome();
};

/* ========= INIT ========= */
renderHome();
</script>

</body>
</html>

name: Build Senti APK (Stable)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build APK using python-for-android Docker
      run: |
        docker pull kivy/buildozer
        docker run --rm \
          -v ${{ github.workspace }}:/home/buildozer/app \
          kivy/buildozer \
          bash -c "
            cd /home/buildozer/app &&
            buildozer init || true &&
            sed -i 's/^title = .*/title = Senti/' buildozer.spec &&
            sed -i 's/^package.name = .*/package.name = senti/' buildozer.spec &&
            sed -i 's/^package.domain = .*/package.domain = org.senti/' buildozer.spec &&
            sed -i 's/^requirements = .*/requirements = python3,kivy/' buildozer.spec &&
            sed -i 's/^android.api = .*/android.api = 31/' buildozer.spec &&
            sed -i 's/^android.minapi = .*/android.minapi = 21/' buildozer.spec &&
            sed -i 's/^orientation = .*/orientation = portrait/' buildozer.spec &&
            sed -i 's|^icon.filename = .*|icon.filename = icon.png|' buildozer.spec &&
            buildozer android debug
          "

    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: senti-apk
        path: bin/*.apk
